{% extends 'base.html' %}

{% block title %}我的预约 - 自习室预约系统{% endblock %}

{% block content %}
<h2 class="mb-4">
    <i class="bi bi-calendar-check"></i> 我的预约
</h2>

<ul class="nav nav-tabs mb-4" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" type="button">
            即将到来的预约 <span class="badge bg-primary">{{ upcoming_bookings.count }}</span>
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" type="button">
            历史预约 <span class="badge bg-secondary">{{ past_bookings.count }}</span>
        </button>
    </li>
</ul>

<div class="tab-content">
    <!-- 即将到来的预约 -->
    <div class="tab-pane fade show active" id="upcoming" role="tabpanel">
        {% if upcoming_bookings %}
        <div class="row">
            {% for booking in upcoming_bookings %}
            <div class="col-md-6 mb-3">
                <div class="card booking-card shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h5 class="card-title mb-0">{{ booking.seat.room.name }}</h5>
                            <span class="badge bg-success">{{ booking.get_status_display }}</span>
                        </div>

                        <p class="mb-2">
                            <i class="bi bi-geo-alt"></i>
                            <strong>座位：</strong>{{ booking.seat.seat_number }}
                        </p>

                        <p class="mb-2">
                            <i class="bi bi-calendar"></i>
                            <strong>日期：</strong>{{ booking.booking_date }}
                        </p>

                        <p class="mb-2">
                            <i class="bi bi-clock"></i>
                            <strong>时段：</strong>
                            <span class="badge badge-{{ booking.time_slot }}">
                                {{ booking.get_time_slot_display }}
                            </span>
                        </p>

                        {% if booking.note %}
                        <p class="mb-2 text-muted">
                            <small><i class="bi bi-pencil"></i> {{ booking.note }}</small>
                        </p>
                        {% endif %}

                        <hr>

                        <div class="d-flex gap-2">
                            {% if booking.can_checkin %}
                            <a href="{% url 'checkin' booking.id %}" class="btn btn-success btn-sm">
                                <i class="bi bi-check-circle"></i> 签到
                            </a>
                            {% endif %}

                            <a href="{% url 'cancel_booking' booking.id %}" class="btn btn-danger btn-sm"
                               onclick="return confirm('确定要取消这个预约吗？')">
                                <i class="bi bi-x-circle"></i> 取消预约
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> 您暂无即将到来的预约
            <a href="{% url 'room_list' %}" class="alert-link">去预约</a>
        </div>
        {% endif %}
    </div>

    <!-- 历史预约 -->
    <div class="tab-pane fade" id="past" role="tabpanel">
        {% if past_bookings %}
        <div class="row">
            {% for booking in past_bookings %}
            <div class="col-md-6 mb-3">
                <div class="card booking-card {{ booking.status }} shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h5 class="card-title mb-0">{{ booking.seat.room.name }}</h5>
                            {% if booking.status == 'completed' %}
                                <span class="badge bg-success">{{ booking.get_status_display }}</span>
                            {% elif booking.status == 'cancelled' %}
                                <span class="badge bg-secondary">{{ booking.get_status_display }}</span>
                            {% elif booking.status == 'expired' %}
                                <span class="badge bg-warning">{{ booking.get_status_display }}</span>
                            {% else %}
                                <span class="badge bg-info">{{ booking.get_status_display }}</span>
                            {% endif %}
                        </div>

                        <p class="mb-2">
                            <i class="bi bi-geo-alt"></i>
                            <strong>座位：</strong>{{ booking.seat.seat_number }}
                        </p>

                        <p class="mb-2">
                            <i class="bi bi-calendar"></i>
                            <strong>日期：</strong>{{ booking.booking_date }}
                        </p>

                        <p class="mb-2">
                            <i class="bi bi-clock"></i>
                            <strong>时段：</strong>
                            <span class="badge badge-{{ booking.time_slot }}">
                                {{ booking.get_time_slot_display }}
                            </span>
                        </p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> 暂无历史预约记录
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
